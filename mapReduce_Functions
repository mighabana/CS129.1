mapP = function() {
  emit({
    symbol: this.symbol
  },{
    count: 1,
    stock: 'Date: ' + this.date + '; Close: ' + this.close
  });
}

reduceP = function(key, values) {
  var total = 0;
  var stock = [];
  for(var i = 0; i < values.length; i++) {
    total += values[i].count;
    stock[i] = values[i].stock;
  }
  return {count: total, stock: stock};
}

resultsPrice = db.runCommand({
  mapReduce: 'prices',
  map: mapP,
  reduce: reduceP,
  out: 'prices.reduced'
});

mapCompanies = function() {
  emit({
    subsectors: this.Sector
  },{
    count: 1,
    symbol: this.Symbol
  });
}

reduceCompanies = function(key,values) {
  var total = 0;
  var symbols = [];
  for(i = 0; i < values.length; i++) {
    symbols[i] = values[i].symbol;
    total += values[i].count;
  }
  return {count: total, symbol: symbols};
}

resultsCompanies = db.runCommand({
  mapReduce:'companylist',
  map: mapCompanies,
  reduce: reduceCompanies,
  out: 'companylist.reduced'
});
